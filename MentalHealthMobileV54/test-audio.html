<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agora Audio Test</title>
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.19.0.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #000;
            color: #fff;
        }
        .status {
            font-size: 18px;
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            background: #1a1a1a;
        }
        .button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        .button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>🎵 Agora Audio Test</h1>
    <div class="status" id="status">Ready to test audio connection...</div>
    
    <button class="button" onclick="testAudio()">Test Audio Connection</button>
    <button class="button" onclick="testMicrophone()">Test Microphone</button>
    
    <div id="log" style="margin-top: 20px; font-family: monospace; font-size: 12px;"></div>
    
    <script>
        let client = null;
        let localAudioTrack = null;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            console.log(message);
        }
        
        async function testAudio() {
            try {
                log('🎵 Starting audio test...');
                document.getElementById('status').innerHTML = 'Testing audio connection...';
                
                // Create client
                client = AgoraRTC.createClient({ 
                    mode: "rtc", 
                    codec: "vp8"
                });
                
                // Set up event listeners
                client.on("user-published", async (user, mediaType) => {
                    log('📱 User published: ' + user.uid + ' (' + mediaType + ')');
                    await client.subscribe(user, mediaType);
                    if (mediaType === "audio") {
                        user.audioTrack.play();
                        log('🔊 Playing remote audio from user: ' + user.uid);
                    }
                });
                
                // Join channel
                const appId = 'efa11b3a7d05409ca979fb25a5b489ae';
                const channel = 'test_audio_' + Date.now();
                const uid = Math.floor(Math.random() * 10000);
                
                log('🔄 Joining channel: ' + channel + ' with UID: ' + uid);
                await client.join(appId, channel, null, uid);
                
                // Create and publish audio track
                localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();
                await client.publish([localAudioTrack]);
                
                log('✅ Successfully connected and published audio!');
                document.getElementById('status').innerHTML = '✅ Connected! Audio is active. Check console for details.';
                
            } catch (error) {
                log('❌ Error: ' + error.message);
                document.getElementById('status').innerHTML = '❌ Error: ' + error.message;
            }
        }
        
        async function testMicrophone() {
            try {
                log('🎤 Testing microphone access...');
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                log('✅ Microphone access granted');
                stream.getTracks().forEach(track => track.stop());
            } catch (error) {
                log('❌ Microphone error: ' + error.message);
            }
        }
        
        // Auto-start test
        window.addEventListener('load', () => {
            log('🚀 Page loaded, ready for testing');
        });
    </script>
</body>
</html>
